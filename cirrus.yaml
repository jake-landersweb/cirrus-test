# Cirrus configuration for cirrus-test project
version: "1"

project:
  name: "cirrus-test"
  description: "Test project for validating Cirrus workflows"

scripts:
  install: "pnpm install"
  build: "pnpm build"
  test: "pnpm test"
  dev: "pnpm --filter api dev"
  lint: "pnpm check-types"
  db:migrate: "pnpm --filter api db:migrate"
  db:seed: "pnpm --filter api db:seed"

apps:
  - name: api
    path: apps/api
    command: "pnpm --filter api dev"
    port: 3000
    health_check: "/health"

infrastructure:
  compose_file: docker/compose.yml
  health_check_services:
    - postgres
    - redis
  health_check_timeout: 120
  env:
    DATABASE_HOST: "localhost"
    DATABASE_PORT: "${postgres.port}"
    DATABASE_URL: "postgresql://postgres:postgres@localhost:${postgres.port}/cirrus_test"
    REDIS_URL: "redis://localhost:${redis.port}"
    REDIS_PORT: "${redis.port}"

environment:
  PORT: "3000"
  NODE_ENV: "development"

agent:
  model: "claude-sonnet-4-20250514"
  max_retries: 3
  timeout: 1800

merge:
  strategy: auto
  squash: false
  delete_branch: true

quality:
  require_tests: false
  require_build: false
  require_lint: false
