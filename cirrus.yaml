# Cirrus configuration for cirrus-test project
version: 1
name: "cirrus-test"
description: "Test project for validating Cirrus workflows"

scripts:
  install: "pnpm install"
  build: "pnpm build"
  test: "pnpm test"
  lint: "pnpm check-types"

apps:
  - name: api
    path: apps/api
    command: "pnpm --filter api dev"
    port: 3000
    health_check: "/health"

infrastructure:
  compose_file: docker/compose.yml
  health_check_services:
    - postgres
    - redis
  health_check_timeout: 120

env:
  - location: ".env.local"
    values:
      DATABASE_HOST: "localhost"
      DATABASE_PORT: "${docker.postgres.port}"
      DATABASE_URL: "postgresql://postgres:postgres@localhost:${docker.postgres.port}/cirrus_test"
      REDIS_URL: "redis://localhost:${docker.redis.port}"
      REDIS_PORT: "${docker.redis.port}"
      PORT: "${app.api.port}"
      CIRRUS_SKIP_QUALITY: "true"
  - location: "apps/api/.env.local"
    values:
      PORT: "${app.api.port}"
      NODE_ENV: "development"
      DATABASE_HOST: "localhost"
      DATABASE_PORT: "${docker.postgres.port}"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "postgres"
      DATABASE_NAME: "cirrus_test"
      REDIS_URL: "redis://localhost:${docker.redis.port}"

agent:
  model: "claude-sonnet-4-20250514"
  max_retries: 3
  timeout: 1800

merge:
  strategy: auto
  squash: false
  delete_branch: true

quality:
  require_tests: false
  require_build: false
  require_lint: false
